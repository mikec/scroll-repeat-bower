angular.module("litl.scrollRepeat",[]).directive("scrollRepeat",["$window","$timeout",function(a,b){function c(){var b=a.innerWidth!==f,c=a.innerHeight!==e;f=a.innerWidth,e=a.innerHeight,g=void 0,h&&h({widthChanged:b,heightChanged:c})}var d,e,f,g,h,i,j,k,l=30,m=500,n=l,o=1,p=50,q=100,r=250,s=angular.element(a),t=angular.element(a.document.body),u=500,v=0,w=50,x=200;return c(),s.bind("resize",function(){(angular.isUndefined(e)||angular.isUndefined(f)||angular.isUndefined(g))&&c(),b.cancel(g),g=b(c,u)}),s.bind("scroll",function(){v=a.document.body.scrollTop,angular.isUndefined(i)&&(i=b(function(){k&&k("debounced"),i=void 0},w)),b.cancel(j),j=b(function(){k("ended")},x),k&&k()}),{compile:function(a,c){for(var g,i,j='<div class="scroll-repeat-item"></div>',s='<div class="scroll-repeat-item scroll-repeat-item-placeholder"></div>',u='<div class="scroll-repeat-item-content"></div>',w=c.scrollRepeat,x=a.children(),y=0;y<x.length;y++){var z=x[y];if(z&&"object"==typeof z){var A=angular.element(z);z.hasAttribute("scroll-repeat-item")?g=A.contents():z.hasAttribute("scroll-repeat-placeholder")&&(i=A.contents())}}g||(g=a.contents());var B=angular.element(j),C=angular.element(u);C.append(angular.element(g)),B.append(C),a.html(""),a.append(B);var D=w.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),E=D[2];return B.attr("ng-repeat",w+" | limitTo:ofs | limitTo:lim"),function(a,c){function g(){var a=Z.length,b=a%o,c=a-P;b>c&&(c=b);var d=c-_;0!==d&&(j(Z,_,d,O),_=c),ba=(a-c)/o*Q;var e=T-X/o,f=$.length;if(e>0){var g=S%o,h=e*o+g;f=$.length-h,0>f&&(f=g),f>$.length&&(f=$.length)}var i=f-aa;0!==i&&(j($,aa,i,O,!0),aa=f)}function j(a,b,c,d){if(c>0)for(var e=b;b+c>e;e++)a[e].css("display","none");else if(0>c)for(var f=b-1;f>=b+c;f--)a[f].css("display",d)}function w(){Y=!0;for(var a=0;p>a;a++){var d=L();Z.push(d),c.prepend(d)}for(var e=0;p>e;e++){var f=L();$.push(f),c.append(f)}angular.isUndefined(O)&&(O=Z[0].css("display")),x(),Z.length<r&&b(w,q)}function x(){g(),M=Math.floor(P/o)*Q-ba,N=M+T*Q,K(M)}function y(b){if(P=b,S>0){X=V+b;var c=V;if(P+c>S){var d=P+c-S;c-=d}a.ofs=X,a.lim=-1*c}else a.ofs=X=n,a.lim=-1*n;x()}function z(){var a=0;if(Q>0){var b=v-U;0>b&&(b=0),a=Math.round(b/Q)*o-d,0>a&&(a=0)}var c=T*o-V;0>c&&(c=0),a>c&&(a=c),y(a)}function A(){var b=M>v,c=v+e>N;a.scrollRepeatClippingTop!==b&&a.$apply(function(){a.scrollRepeatClippingTop=b}),a.scrollRepeatClippingBottom!==c&&a.$apply(function(){a.scrollRepeatClippingBottom=c})}function B(){W=T*Q,t.css("height",W+"px")}function C(){if(D(),0===Q)n=l,d=0;else{var a=Math.round(e/(Q/o));n=a+a*l,n>m&&(n=m),d=Math.round((n-a)/2),d-=d%o}var b=S%o;T=(0===b?S:S+(o-b))/o,V=n>S?S:n-n%o,z(),B()}function D(){Q=H(),R=I(),o=F(),U=G()}function F(){return Math.floor(f/R)}function G(){return c[0].offsetTop}function H(){return J(c.children()[Z.length],"offsetHeight")}function I(){return J(c.children()[Z.length],"offsetWidth")}function J(a,b){var c=0;if(a&&"object"==typeof a){var d=a[b],e=angular.element(a).children()[0];if(e&&"object"==typeof e){var f=e[b];c=d>f?d:f}}return c}function K(a){var b="translateY("+a+"px)";c.css("transform",b),c.css("webkitTransform",b),c.css("mozTransform",b)}function L(){var a=angular.element(s),b=angular.element(u);return i&&b.append(angular.element(i.clone())),a.append(b),a}var M,N,O,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=!1,Z=[],$=[],_=0,aa=0,ba=0;a.scrollRepeatClippingTop=!1,a.scrollRepeatClippingBottom=!1,z(),a.$watchCollection(E,function(a){a&&(S=a.length),b(function(){C(),S>0&&!Y&&S>n&&w()})}),k=function(a){("debounced"==a||"ended"==a)&&z(),A()},h=function(a){a.widthChanged&&C()}}}}}]);