angular.module("litl",[]).directive("scrollRepeat",["$window","$timeout",function(a,b){function c(){var b=a.innerWidth!==f,c=a.innerHeight!==e;f=a.innerWidth,e=a.innerHeight,g=void 0,h&&h({widthChanged:b,heightChanged:c})}var d,e,f,g,h,i,j,k,l=30,m=500,n=l,o=1,p=250,q=200,r=5e3,s=angular.element(a),t=angular.element(a.document.body),u=500,v=0,w=500,x=200;return c(),s.bind("resize",function(){(angular.isUndefined(e)||angular.isUndefined(f)||angular.isUndefined(g))&&c(),b.cancel(g),g=b(c,u)}),s.bind("scroll",function(){v=a.document.body.scrollTop,angular.isUndefined(i)&&(i=b(function(){k&&k("debounced"),i=void 0},w)),b.cancel(j),j=b(function(){k("ended")},x),k&&k()}),{compile:function(a,c){for(var f,g,i='<div class="scroll-repeat-item"></div>',j='<div class="scroll-repeat-item scroll-repeat-item-placeholder"></div>',s='<div class="scroll-repeat-item-content"></div>',u=c.scrollRepeat,w=a.children(),x=0;x<w.length;x++){var y=w[x];if(y&&"object"==typeof y){var z=angular.element(y);y.hasAttribute("scroll-repeat-item")?f=z.contents():y.hasAttribute("scroll-repeat-placeholder")&&(g=z.contents())}}f||(f=a.contents());var A=angular.element(i),B=angular.element(s);B.append(angular.element(f)),A.append(B),a.html(""),a.append(A);var C=u.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),D=C[2];return A.attr("ng-repeat",u+" | limitTo:ofs | limitTo:lim"),function(a,c){function f(){var b=V.length,c=b%o,d=b-N;c>d&&(d=c);var e=d-X;0!==e&&(i(V,X,e,M),X=d),Z=(b-d)/o*O;var f=o-P%o,g=Q-a.ofs/o,h=g*o+f,j=W.length-h;0>j&&(j=0),j>W.length&&(j=W.length);var k=j-Y;0!==k&&(i(W,Y,k,M,!0),Y=j)}function i(a,b,c,d){if(c>0)for(var e=b;b+c>e;e++)a[e].css("display","none");else if(0>c)for(var f=b-1;f>=b+c;f--)a[f].css("display",d)}function u(){U=!0;for(var a=0;p>a;a++){var d=J();V.push(d),c.prepend(d)}for(var e=0;p>e;e++){var f=J();W.push(f),c.append(f)}angular.isUndefined(M)&&(M=V[0].css("display")),w(),V.length<r&&b(u,q)}function w(){f(),K=Math.floor(N/o)*O-Z;var a=Math.ceil(n/o);L=K+a*O,I(K)}function x(b){if(N=b,P>0){var c=S+b,d=S;if(N+d>P){var e=N+d-P;d-=e}a.ofs=c,a.lim=-1*d}else a.ofs=n,a.lim=-1*n;w()}function y(){var a=0;if(O>0){var b=v-R;0>b&&(b=0),a=Math.round(b/O)*o-d,0>a&&(a=0)}var c=Q*o-S;0>c&&(c=0),a>c&&(a=c),x(a)}function z(){var b=K>v,c=v+e>L;a.scrollRepeatClippingTop!==b&&a.$apply(function(){a.scrollRepeatClippingTop=b}),a.scrollRepeatClippingBottom!==c&&a.$apply(function(){a.scrollRepeatClippingBottom=c})}function A(){T=Q*O,t.css("height",T+"px")}function B(){if(C(),0===O)n=l,d=0;else{var a=Math.round(e/(O/o));n=a+a*l,n>m&&(n=m),d=Math.round((n-a)/2),d-=d%o}var b=P%o;Q=(0===b?P:P+(o-b))/o,S=n>P?P:n-n%o,y(),A()}function C(){O=G(),o=E(),R=F()}function E(){for(var a,b=1,d=c.children(),e=0,f=X,g=X+P,h=f;g>=h;h++){var i=d[h];if(!i||"object"!=typeof i)break;var j=H(i,"offsetTop");if(j>=0){if(angular.isUndefined(a)&&(a=j),j!=a)break;b=e+1,e++}}return b}function F(){return c[0].offsetTop}function G(){return H(c.children()[V.length],"offsetHeight")}function H(a,b){var c=0;if(a&&"object"==typeof a){var d=a[b],e=angular.element(a).children()[0];if(e&&"object"==typeof e){var f=e[b];c=d>f?d:f}}return c}function I(a){var b="translateY("+a+"px)";c.css("transform",b),c.css("webkitTransform",b),c.css("mozTransform",b)}function J(){var a=angular.element(j),b=angular.element(s);return g&&b.append(angular.element(g.clone())),a.append(b),a}var K,L,M,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=!1,V=[],W=[],X=0,Y=0,Z=0;a.scrollRepeatClippingTop=!1,a.scrollRepeatClippingBottom=!1,y(),a.$watchCollection(D,function(a){a&&(P=a.length),b(function(){B(),P>0&&!U&&P>n&&u()})}),k=function(b){"debounced"!=b||a.scrollRepeatClippingTop||a.scrollRepeatClippingBottom?"ended"==b&&y():y(),z()},h=function(a){a.widthChanged&&B()}}}}}]);