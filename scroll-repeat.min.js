angular.module("litl.scrollRepeat",[]).directive("scrollRepeat",["$window","$timeout",function(a,b){function c(){var b=a.innerWidth!==g,c=a.innerHeight!==f;g=a.innerWidth,f=a.innerHeight,h=void 0,i&&i({widthChanged:b,heightChanged:c})}var d,e,f,g,h,i,j,k,l,m=5,n=100,o=50,p=100,q=250,r=500,s=500,t=500,u=m,v=1,w=angular.element(a),x=angular.element(a.document.body),y=0;return c(),w.bind("resize",function(){(angular.isUndefined(f)||angular.isUndefined(g)||angular.isUndefined(h))&&c(),b.cancel(h),h=b(c,r)}),w.bind("scroll",function(){y=a.document.documentElement.scrollTop||a.document.body.scrollTop,angular.isUndefined(j)&&(j=b(function(){l&&l("debounced"),j=void 0},s)),b.cancel(k),k=b(function(){l&&l("ended")},t),l&&l()}),{compile:function(a,c){m=parseInt(c.bufferAmt)||m,n=parseInt(c.maxAllowedItems)||n,o=parseInt(c.phCreationChunkSize)||o,p=parseInt(c.phCreationInterval)||p,q=parseInt(c.phMaxAllowed)||q,r=parseInt(c.resizeDebounceTime)||r,s=parseInt(c.scrollDebounceTime)||s,t=parseInt(c.scrollEndTime)||t;for(var h,j,k='<div class="scroll-repeat-item"></div>',w='<div class="scroll-repeat-item scroll-repeat-item-placeholder"></div>',z='<div class="scroll-repeat-item-content">&nbsp;</div>',A=c.scrollRepeat,B=a.children(),C=0;C<B.length;C++){var D=B[C];if(D&&"object"==typeof D){var E=angular.element(D);D.hasAttribute("scroll-repeat-item")?h=E.contents():D.hasAttribute("scroll-repeat-placeholder")&&(j=E.contents())}}h||(h=a.contents());var F=angular.element(k),G=angular.element(z);G.html(""),G.append(angular.element(h)),F.append(G),a.html(""),a.append(F);var H=A.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),I=H[2];return F.attr("ng-repeat",A+" | limitTo:ofs | limitTo:lim"),function(a,c){function h(){var a=aa.length,b=a%v,c=Q/d*v,e=a-c;b>e&&(e=b);var f=e-ca;0!==f&&(k(aa,ca,f,P),ca=e),ea=(a-e)/v*V;var g=U-$/d/v,h=ba.length;if(g>0){var i=g*v;h=ba.length-i,0>h&&(h=0),h>ba.length&&(h=ba.length)}var j=h-da;0!==j&&(k(ba,da,j,P,!0),da=h)}function k(a,b,c,d){if(c>0)for(var e=b;b+c>e;e++)a[e].css("display","none");else if(0>c)for(var f=b-1;f>=b+c;f--)a[f].css("display",d)}function r(){_=!0;for(var a=0;o>a;a++){var d=M();aa.push(d),c.prepend(d),W&&V||E()}for(var e=0;o>e;e++){var f=M();ba.push(f),c.append(f)}angular.isUndefined(P)&&(P=aa[0].css("display")),s(),aa.length<q&&b(r,p)}function s(){h(),N=Math.floor(Q/d)*R-ea,O=N+U*R,L(N)}function t(b){if(Q=b,T>0){$=Y+b;var c=Y;if(Q+c>T){var d=Q+c-T;c-=d}a.ofs=$,a.lim=-1*c}else a.ofs=$=u,a.lim=-1*u;s()}function A(){var a=0;if(R>0){var b=y-X;0>b&&(b=0),a=Math.round(b/R)*d-e,0>a&&(a=0)}var c=U*d-Y;0>c&&(c=0),a>c&&(a=c),t(a)}function B(){Z=U*R,x.css("height",Z+"px")}function C(){if(D(),0===R)u=m,e=0;else{var a=Math.round(f/(R/d));u=a+a*m,u>n&&(u=n),e=Math.round((u-a)/2),e-=e%d}var b=T%d;U=(0===b?T:T+(d-b))/d,Y=u>T?T:u-u%d,A(),B()}function D(){R=H(),S=J(),d=F(S),X=G()}function E(){W=K(aa[0],"offsetWidth"),V=K(aa[0],"offsetHeight"),v=F(W)}function F(a){return Math.floor(g/a)}function G(){return c[0].offsetTop}function H(){return K(c.children()[aa.length],"offsetHeight")}function J(){return K(c.children()[aa.length],"offsetWidth")}function K(a,b){var c=0;if(a&&"object"==typeof a){a.html&&a[0]&&(a=a[0]);var d=a[b],e=angular.element(a).children()[0];if(e&&"object"==typeof e){var f=e[b];c=d>f?d:f}}return c}function L(a){var b="translateY("+a+"px)";c.css("transform",b),c.css("webkitTransform",b),c.css("mozTransform",b)}function M(){var a=angular.element(w),b=angular.element(z);return j&&(b.html(""),b.append(angular.element(j.clone()))),a.append(b),a}var N,O,P,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=0,$=0,_=!1,aa=[],ba=[],ca=0,da=0,ea=0;A(),a.$watchCollection(I,function(a){a&&(T=a.length),b(function(){C(),T>0&&!_&&T>u&&r()})}),l=function(a){("debounced"==a||"ended"==a)&&A()},i=function(a){a.widthChanged&&C()}}}}}]);